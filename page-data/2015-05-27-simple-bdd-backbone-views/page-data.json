{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2015-05-27-simple-bdd-backbone-views/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Diego Castillo"}},"markdownRemark":{"id":"c433f679-adad-533f-b9c2-c996305f38aa","excerpt":"Backbone.js is a small Javascript library which helps give structure to web applications. In contrast to the many other front end technologies out there…","html":"<p><a href=\"http://backbonejs.org\">Backbone.js</a> is a small Javascript library which helps give structure to web applications. In contrast to the many other front end technologies out there, Backbone attempts to give just as little as possible in order to build an application. As a result, we need to be extra careful when designing and developing an application to make it easy to test and maintain in the future.</p>\n<p>In this blog post, I will explain how to write a simple and maintainable Backbone view. I will be creating a simple cart item comment form view using <a href=\"http://guide.agilealliance.org/guide/bdd.html\">BDD</a> which will allow the user to enter a comment on a cart item. I will be using <a href=\"http://coffeescript.org/\">Coffeescript</a> and the <a href=\"http://jasmine.github.io/\">Jasmine</a> testing framework as tools to develop and test the view.</p>\n<p>A Backbone view can be thought of as a controller in the <a href=\"http://st-www.cs.illinois.edu/users/smarch/st-docs/mvc.html\">MVC</a> software design pattern. It handles user input, and it is in charge of updating the necessary DOM elements when appropriate. A view should know as little as possible about the application, in other words, it needs to be as dumb as it can be. It should not perform any complicated logic, instead, it should only be in charge of rendering and updating data in its associated model. The model related to this view will be the <a href=\"http://en.wikipedia.org/wiki/Single_Source_of_Truth\">Single Source of Truth</a>; all the information the view is going to use is going to be stored and retrieved from a single place.</p>\n<p>When creating a view, I like to divide it into four smaller segments:</p>\n<ul>\n<li>Initialization: Test whether this view exists and if it has the data it needs in order to work properly.</li>\n<li>Rendering: Test if the template is rendered and its values are correct.</li>\n<li>Events: Test if a view listens accurately to user interaction with it.</li>\n<li>Methods: Test whether the view delegates the action correctly.</li>\n</ul>\n<p>We will start up by creating the first test at <code class=\"language-text\">cart_item_comment_form_view_spec.js.coffee</code> to make sure the view is defined and accessible:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">describe <span class=\"token string\">'Cart Item Comment Form View'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n  it <span class=\"token string\">'is defined'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>App<span class=\"token punctuation\">.</span>Views<span class=\"token punctuation\">.</span>CartItemCommentForm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In order to make this test pass, we simply declare the view at <code class=\"language-text\">cart_item_comment_form_view.js.coffee</code> as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App<span class=\"token punctuation\">.</span>Views<span class=\"token punctuation\">.</span>CartItemCommentForm</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span></code></pre></div>\n<p>Next, we need to test the view initialization by making sure it has the correct tagName, className, and the necessary options in order to work. Since this view will set or get the cart item comment according to user interaction, a cart item model will be required in order for it to work. Luckily, jasmine provides two helper methods to help creating <a href=\"http://en.wikipedia.org/wiki/Don%27t_repeat_yourself\">DRY</a> tests; <code class=\"language-text\">beforeEach</code>, and <code class=\"language-text\">afterEach.</code> We will setup the view to test on the <code class=\"language-text\">beforeEach</code> method by passing to it a cart item model, and then clean it up on the <code class=\"language-text\">afterEach</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">beforeEach <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  cartItemModel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>Model</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  options <span class=\"token operator\">=</span>\n    <span class=\"token property\">cartItemModel</span><span class=\"token operator\">:</span> cartItemModel\n  <span class=\"token class-member variable\">@view</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">App<span class=\"token punctuation\">.</span>Views<span class=\"token punctuation\">.</span>CartItemCommentForm</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n\nafterEach <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token class-member variable\">@view</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span></code></pre></div>\n<p>Now, we can create the necessary tests to check if the view is being initialized correctly:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">describe <span class=\"token string\">'Initialization'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n  it <span class=\"token string\">'has correct tagName'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>tagName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\n\n  it <span class=\"token string\">'has correct className'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cart-item-comment-form'</span><span class=\"token punctuation\">)</span>\n\n  it <span class=\"token string\">'throws error if no “cartItemModel” is passed to it'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token comment\"># Save error on variable</span>\n    throwMeAnError <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token comment\"># Initialize view without a cart item model</span>\n      <span class=\"token keyword\">new</span> <span class=\"token class-name\">App<span class=\"token punctuation\">.</span>Views<span class=\"token punctuation\">.</span>CartItemCommentForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>throwMeAnError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toThrow</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A cart item model is required.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  it <span class=\"token string\">'sets cart item model correctly'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>Model</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toBeTruthy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To make the tests pass, we need to add the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token property\">tagName</span><span class=\"token operator\">:</span> <span class=\"token string\">'div'</span>\n\n<span class=\"token property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">'cart-item-comment-form'</span>\n\n<span class=\"token comment\"># Initialize view</span>\n<span class=\"token property\">initialize</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token comment\"># Check for view requirements</span>\n  <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span><span class=\"token class-member variable\">@options</span><span class=\"token punctuation\">.</span>cartItemModel\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A cart item model is required.'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\"># Initialize view requirements</span>\n  <span class=\"token class-member variable\">@cartItemModel</span> <span class=\"token operator\">=</span> <span class=\"token class-member variable\">@options</span><span class=\"token punctuation\">.</span>cartItemModel</code></pre></div>\n<p>We have successfully tested our cart item comment form view is being initialized properly. It is now time to test whether it is being rendered as expected. As far as templates, I have found it is better to write inline templates even though they might seem more difficult to understand. But by using inline templates, we force ourselves as developers to write smaller, simpler, and logicless templates, which in turn will help us to create a more independent and maintainable application.</p>\n<p>With the following tests, I want to make sure if the view renders a cart item comment when one is present, and if it renders an empty textarea if no cart item comment is present.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">describe <span class=\"token string\">'Rendering'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n  describe <span class=\"token string\">'when cart item has comment'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n    beforeEach <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token comment\"># Override getComment stub</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>getComment <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token string\">'foo'</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    afterEach <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>getComment <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token keyword\">return</span>\n\n    it <span class=\"token string\">'renders cart item comment on textarea'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.comment-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n\n  describe <span class=\"token string\">'when cart item doesn\\'t have comment'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n    it <span class=\"token string\">'renders empty comment textarea'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.comment-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In order for this tests to pass, we will first need to add stubs for the <code class=\"language-text\">getComment</code> and <code class=\"language-text\">setComment</code> methods of a cart item model because we are testing the view not the model. Therefore, our test setup will now look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">beforeEach <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  cartItemModel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>Model</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># Create stub for getComment</span>\n  cartItemModel<span class=\"token punctuation\">.</span>getComment <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token keyword\">return</span>\n  <span class=\"token comment\"># Create stub for setComment</span>\n  cartItemModel<span class=\"token punctuation\">.</span>setComment <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token keyword\">return</span>\n  options <span class=\"token operator\">=</span>\n    <span class=\"token property\">cartItemModel</span><span class=\"token operator\">:</span> cartItemModel\n  <span class=\"token class-member variable\">@view</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">App<span class=\"token punctuation\">.</span>Views<span class=\"token punctuation\">.</span>CartItemCommentForm</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n  <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Notice I call <code class=\"language-text\">render</code> at the end of the <code class=\"language-text\">beforeEach</code> block. This will allow the view to be “cleansed” after every single test.</p>\n<p>To make the tests above turn green, lets add the following code to the view:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token property\">template</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'&lt;textarea cols=\"30\" rows=\"10\" class=\"comment-area\">'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'&lt;%= comment %>'</span> <span class=\"token operator\">+</span>\n  <span class=\"token string\">'&lt;/textarea>'</span>\n  <span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Render view on template</span>\n<span class=\"token property\">render</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  context <span class=\"token operator\">=</span>\n    <span class=\"token property\">comment</span><span class=\"token operator\">:</span> <span class=\"token class-member variable\">@cartItemModel</span><span class=\"token punctuation\">.</span><span class=\"token function\">getComment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  @$el<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">template</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  @</code></pre></div>\n<p>The next thing to test are events. The user needs to be able to write a comment on the textarea and the view must delegate this action to the cart item model in order for it to automatically set the comment. Therefore, the cart item comment form view has to listen to the <code class=\"language-text\">keyup</code>, and <code class=\"language-text\">change</code> events and then delegate this action to the cart item model. In order to test for this, I will use Jasmine <a href=\"http://jasmine.github.io/2.0/introduction.html#section-Spies\">spies</a> to check if the view calls correctly the desired method.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">describe <span class=\"token string\">'Events'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n  it <span class=\"token string\">'it listens to \"keyup\" event on textarea'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'setComment'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">delegateEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'textarea'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyup'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">.</span>calls<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n  it <span class=\"token string\">'it listens to \"change\" event on textarea'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'setComment'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">delegateEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'textarea'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">.</span>calls<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Notice I call <code class=\"language-text\">delegateEvents</code> after each spy I create. The main reason for doing that is to refresh the view events to be able to call the spy later. To make the new tests pass, we will need to add the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># View events</span>\n<span class=\"token property\">events</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token string-property property\">'keyup textarea'</span><span class=\"token operator\">:</span> <span class=\"token string\">'setComment'</span>\n  <span class=\"token string-property property\">'change textarea'</span><span class=\"token operator\">:</span> <span class=\"token string\">'setComment'</span>\n\n<span class=\"token comment\"># Sets comment on cart item model</span>\n<span class=\"token property\">setComment</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The last thing to test in the view are methods. View methods shouldn’t be cumbersome with complicated logic and business rules. As I said above, the view doesn’t need to know anything about the application. As a result of this, I will test if the view calls the appropriate model function (<code class=\"language-text\">setComment</code>), that is, test if it correctly delegates the action to the model, and if the it returns itself from the <code class=\"language-text\">render</code> method (to allow for chaining).</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">describe <span class=\"token string\">'Methods'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n  describe <span class=\"token string\">'#render'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n    it <span class=\"token string\">'returns the view object'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">)</span>\n\n  describe <span class=\"token string\">'#setComment'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n    it <span class=\"token string\">'calls \"setComment\" on cart item model'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">,</span> <span class=\"token string\">'setComment'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">delegateEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      comment <span class=\"token operator\">=</span> <span class=\"token string\">'foo'</span>\n      <span class=\"token class-member variable\">@view</span>\n        <span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.comment-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\"># Fake preventDefault</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">setComment</span><span class=\"token punctuation\">(</span><span class=\"token property\">preventDefault</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">)</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">.</span>calls<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># User might want to erase comment</span>\n    it <span class=\"token string\">'calls \"setComment\" on cart item model if comment is empty'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">,</span> <span class=\"token string\">'setComment'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">delegateEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      comment <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n      <span class=\"token class-member variable\">@view</span>\n        <span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.comment-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\"># Fake preventDefault</span>\n      <span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span><span class=\"token function\">setComment</span><span class=\"token punctuation\">(</span><span class=\"token property\">preventDefault</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">)</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token class-member variable\">@view</span><span class=\"token punctuation\">.</span>cartItemModel<span class=\"token punctuation\">.</span>setComment<span class=\"token punctuation\">.</span>calls<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In order to make the tests turn green, all we need to do is to fill <code class=\"language-text\">setComment</code> in the view as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># Sets comment on cart item model</span>\n<span class=\"token property\">setComment</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  comment <span class=\"token operator\">=</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span>@$el<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.comment-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token class-member variable\">@cartItemModel</span><span class=\"token punctuation\">.</span><span class=\"token function\">setComment</span><span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>Writing small, modular, and well designed views is extremly important, and by defining the real purpose of a view, bad practices and patterns can be quickly avoided and thus help us to create a sane and maintainable application. Always keep in mind that view tests catch the most regression issues, therefore, even though creating tests for views can sometimes be a daunting task, at the long run, it will always be worthy.</p>","frontmatter":{"title":"Simple BDD Backbone Views","date":"May 27, 2015","description":null}},"previous":null,"next":{"fields":{"slug":"/2015-07-28-backbone-required-attributes/"},"frontmatter":{"title":"Backbone Required Attributes"}}},"pageContext":{"id":"c433f679-adad-533f-b9c2-c996305f38aa","previousPostId":null,"nextPostId":"b951a101-7b01-5964-b657-4b13ad9c245c"}},
    "staticQueryHashes": ["650872877"]}